<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Digital Poster — Single Page</title>
  <style>
    :root{--accent:#0b74de;--muted:#666}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;line-height:1.45;color:#111;background:#f7f9fc}
    header{background:#fff;padding:24px;border-bottom:1px solid #e6edf6}
    header h1{margin:0;font-size:1.6rem}
    main{max-width:980px;margin:28px auto;padding:0 16px}
    .product{display:flex;gap:20px;background:#fff;padding:18px;border-radius:8px;box-shadow:0 2px 8px rgba(12,30,60,0.06)}
    .product img{width:320px;height:auto;border-radius:4px;object-fit:cover}
    .product-info{flex:1}
    .price{margin:6px 0 12px}
    .pay-btn{display:inline-block;padding:8px 12px;background:var(--accent);color:#fff;border-radius:6px;text-decoration:none}
    .qr img{width:180px;height:180px;margin-top:10px;border:1px solid #e6edf6;padding:6px;background:#fff}
    .contact{margin-top:18px;background:#fff;padding:16px;border-radius:8px}
    .contact form{display:grid;gap:10px}
    .contact label{font-size:0.95rem;color:var(--muted)}
    .contact input,.contact textarea{width:100%;padding:8px;border:1px solid #d6e3f2;border-radius:6px}
    .form-actions{display:flex;gap:10px;margin-top:6px}
    .form-actions button{padding:10px 14px;border-radius:6px;border:0;background:var(--accent);color:#fff;cursor:pointer}
    .visitors{margin-top:18px;background:#fff;padding:16px;border-radius:8px}
    .msg{margin-top:8px;color:green}
    footer{max-width:980px;margin:22px auto;padding:0 16px;color:var(--muted)}
    @media(max-width:720px){.product{flex-direction:column}.product img{width:100%}}
  </style>
</head>
<body>
  <header>
    <h1>Digital Poster</h1>
    <p>Buy high-quality digital posters. Pay via UPI to contact number: <strong>7410514965</strong></p>
  </header>

  <main>
    <section class="product">
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='600' height='800'><rect width='100%' height='100%' fill='%23eee'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='28' fill='%23333'>Digital Poster Preview</text></svg>" alt="Digital Poster">
      <div class="product-info">
        <h2>Exclusive Digital Poster</h2>
        <p class="price">Price: <strong>₹199</strong></p>
        <div class="upi">
          <h3>Pay via UPI</h3>
          <p>UPI / Contact: <strong>7410514965</strong></p>
          <p>Tap to pay (mobile) or scan QR:</p>
          <a id="upiLink" href="#" class="pay-btn">Open UPI App</a>
          <div class="qr">
            <img id="qrImg" alt="UPI QR">
          </div>
        </div>
      </div>
    </section>

    <section class="contact">
      <h3>Contact / Order Form</h3>
      <form id="contactForm">
        <label>Name<br><input type="text" name="name" required></label>
        <label>Email id<br><input type="email" name="email" required></label>
        <label>Mobile Number (with country code)<br><input type="tel" name="mobile" placeholder="+91xxxxxxxxxx" required></label>
        <label>Full Address<br><textarea name="address" rows="3" required></textarea></label>
        <label>District<br><input type="text" name="district" required></label>
        <label>State<br><input type="text" name="state" required></label>
        <div class="form-actions">
          <button type="submit">Submit Order Details</button>
          <button type="button" id="paidBtn">I've Paid — Get Download</button>
          <button type="button" id="pngBtn">Download PNG</button>
        </div>
      </form>
      <div id="formMsg" class="msg"></div>
    </section>

    <section class="visitors">
      <h3>Visitor Counts</h3>
      <p>Daily visitors (this browser): <strong id="dailyCount">0</strong></p>
      <p>Monthly visitors (this browser): <strong id="monthlyCount">0</strong></p>
    </section>
  </main>

  <footer>
    <p>Contact for payments & queries: <strong>7410514965</strong> (WhatsApp)</p>
  </footer>

  <script>
    // Configuration
    const CONTACT_NUMBER = '7410514965';
    const COUNTRY_CODE = '91';
    const UPI_ID = `${CONTACT_NUMBER}@upi`;
    const PRODUCT_NAME = 'Digital Poster';
    const PRICE = '199';

    // Build UPI deep link
    function buildUpiLink(amount = ''){
      const pa = encodeURIComponent(UPI_ID);
      const pn = encodeURIComponent(PRODUCT_NAME);
      const am = amount ? `&am=${encodeURIComponent(amount)}` : '';
      return `upi://pay?pa=${pa}&pn=${pn}${am}&cu=INR`;
    }

    // Build QR using Google Chart API
    function buildQrUrl(link){
      return 'https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=' + encodeURIComponent(link);
    }

    // Create poster SVG string (customizable)
    function createPosterSvg(name){
      return `<?xml version="1.0" encoding="utf-8"?>\n` +
        `<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1800" viewBox="0 0 1200 1800">` +
        `<defs><linearGradient id="g" x1="0" x2="1"><stop offset="0%" stop-color="#0b74de"/>`+
        `<stop offset="100%" stop-color="#7bd389"/></linearGradient></defs>`+
        `<rect width="100%" height="100%" fill="#fff"/>`+
        `<rect x="60" y="60" width="1080" height="1680" rx="24" fill="url(#g)" opacity="0.12"/>`+
        `<g font-family="Georgia, serif" fill="#0b2b4a">`+
        `<text x="120" y="260" font-size="72" font-weight="700">Exclusive Digital Poster</text>`+
        `<text x="120" y="360" font-size="36">High-resolution artwork — instant download</text>`+
        `</g>`+
        `<g transform="translate(120,460)"><rect width="960" height="960" rx="12" fill="#fff" stroke="#e6edf6"/>`+
        `<text x="40" y="120" font-size="40" fill="#334862">${escapeXml(name || 'Your Name')}</text></g>`+
        `<g font-family="Arial, sans-serif" fill="#0b2b4a">`+
        `<text x="120" y="1500" font-size="36">Price: ₹${PRICE}</text>`+
        `<text x="120" y="1560" font-size="20">Contact / UPI: ${CONTACT_NUMBER}</text>`+
        `</g></svg>`;
    }

    function escapeXml(s){ return String(s).replace(/[<>&\"']/g,function(c){ return {'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;',"'":"&apos;"}[c]; }); }

    document.addEventListener('DOMContentLoaded', ()=>{
      const upiLink = buildUpiLink(PRICE);
      const upiAnchor = document.getElementById('upiLink');
      upiAnchor.setAttribute('href', upiLink);
      document.getElementById('qrImg').src = buildQrUrl(upiLink);

      updateVisitorCounts();

      const form = document.getElementById('contactForm');
      const formMsg = document.getElementById('formMsg');
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const data = new FormData(form);
        const entry = {
          name: data.get('name'),
          email: data.get('email'),
          mobile: data.get('mobile'),
          address: data.get('address'),
          district: data.get('district'),
          state: data.get('state'),
          ts: new Date().toISOString()
        };
        saveContact(entry);
        formMsg.textContent = 'Order details saved locally. After payment click "I\'ve Paid — Get Download".';
        form.reset();
      });

      document.getElementById('paidBtn').addEventListener('click', ()=>{
        const contacts = JSON.parse(localStorage.getItem('contacts')||'[]');
        const last = contacts[contacts.length-1];
        if(!last){ alert('Please submit your order details first using the form.'); return; }
        const txnId = prompt('Enter UPI transaction/ref ID you received after payment:');
        if(!txnId){ alert('Transaction ID is required to proceed.'); return; }

        // Client-side delivery: generate SVG and trigger download (SVG)
        const svg = createPosterSvg(last.name);
        downloadBlob(new Blob([svg], {type: 'image/svg+xml'}), `digital-poster-${Date.now()}.svg`);

        // Open WhatsApp to notify seller (replace country code if needed)
        const message = encodeURIComponent(`Payment received. Txn: ${txnId}. Buyer: ${last.name || ''} ${last.mobile || ''}`);
        const waUrl = `https://wa.me/${COUNTRY_CODE}${CONTACT_NUMBER}?text=${message}`;
        window.open(waUrl, '_blank');
      });

      // PNG download button: convert SVG to PNG client-side
      document.getElementById('pngBtn').addEventListener('click', async ()=>{
        const contacts = JSON.parse(localStorage.getItem('contacts')||'[]');
        const last = contacts[contacts.length-1];
        if(!last){ alert('Please submit your order details first using the form.'); return; }
        const svg = createPosterSvg(last.name);
        try{
          const pngBlob = await svgToPngBlob(svg, 1200, 1800);
          downloadBlob(pngBlob, `digital-poster-${Date.now()}.png`);
        }catch(err){
          alert('Failed to generate PNG: ' + err.message);
        }
      });
    });

    function saveContact(entry){
      const contacts = JSON.parse(localStorage.getItem('contacts')||'[]');
      contacts.push(entry);
      localStorage.setItem('contacts', JSON.stringify(contacts));
    }

    // Visitor counting functions (stored per-date in localStorage)
    function todayKey(){ const d = new Date(); return d.toISOString().slice(0,10); }
    function monthKey(){ const d = new Date(); return d.toISOString().slice(0,7); }
    function updateVisitorCounts(){
      const counts = JSON.parse(localStorage.getItem('visitorCounts')||'{}');
      const tKey = todayKey(); const mKey = monthKey();
      const sessionFlag = sessionStorage.getItem('visited_' + tKey);
      if(!sessionFlag){ counts[tKey] = (counts[tKey]||0) + 1; localStorage.setItem('visitorCounts', JSON.stringify(counts)); sessionStorage.setItem('visited_' + tKey, '1'); }
      document.getElementById('dailyCount').textContent = counts[tKey] || 0;
      let monthly = 0; Object.keys(counts).forEach(k=>{ if(k.startsWith(mKey)) monthly += counts[k]; });
      document.getElementById('monthlyCount').textContent = monthly;
    }

    // Helpers: download a blob as a file
    function downloadBlob(blob, filename){
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    // Convert SVG string to PNG Blob using an offscreen canvas
    function svgToPngBlob(svgString, width, height){
      return new Promise((resolve, reject)=>{
        const img = new Image();
        const svg64 = btoa(unescape(encodeURIComponent(svgString)));
        const dataUrl = 'data:image/svg+xml;base64,' + svg64;
        img.onload = ()=>{
          try{
            const canvas = document.createElement('canvas');
            canvas.width = width; canvas.height = height;
            const ctx = canvas.getContext('2d');
            // White background
            ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            canvas.toBlob((blob)=>{ if(blob) resolve(blob); else reject(new Error('Canvas toBlob returned null')); }, 'image/png');
          }catch(err){ reject(err); }
        };
        img.onerror = (e)=> reject(new Error('Failed to load SVG image'));
        img.src = dataUrl;
      });
    }
  </script>
</body>
</html>
